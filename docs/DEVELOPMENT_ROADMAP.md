# LogCortex V3 开发路线图

## 当前版本: V3.0

### 已完成功能 ✅

| 功能 | 状态 | 说明 |
|------|------|------|
| AI 智能分析模块 | ✅ 完成 | modules/ai_agent/ 完整实现 |
| L1 摘要层工具 | ✅ 完成 | get_quick_health_check, get_subsystem_summary |
| L2 统计层工具 | ✅ 完成 | get_signal_stats, detect_anomalies |
| 上下文管理器 | ✅ 完成 | 智能压缩，多级触发 |
| 诊断流程控制 | ✅ 完成 | 5阶段诊断流程 |
| 预设诊断模板 | ✅ 完成 | 7种预设模板 |
| 实时进度反馈 | ✅ 完成 | 工具调用日志显示 |
| 斜杠命令 | ✅ 完成 | /quick, /full, /gps 等 |
| 后台分析 | ✅ 完成 | 切换页面不中断 |
| GLM-5 默认支持 | ✅ 完成 | 默认使用 GLM-5 模型 |

---

## 下一步开发任务评估

### 优先级说明
- **P0**: 核心功能，强烈建议优先
- **P1**: 重要功能，显著提升体验
- **P2**: 增强功能，提升专业度
- **P3**: 锦上添花，可后续迭代

---

### 任务 1: 多日志对比分析 (P0)

**描述**: 支持同时加载多个日志文件，进行横向对比分析

**用户价值**:
- 对比同一次飞行的多个阶段
- 对比不同日期的飞行表现
- 找出性能退化趋势

**技术方案**:
```
1. 扩展 session_state 支持多 analyzer 实例
2. 新增日志选择器 UI
3. 新增对比工具:
   - compare_subsystems(log1, log2, subsystem)
   - compare_signals(log1, log2, signal_path)
4. AI prompt 支持"对比分析"模式
```

**工作量**: 2-3 天

**文件改动**:
- `app.py`: 多日志选择 UI
- `modules/ai_agent/tools.py`: 新增对比工具
- `modules/ai_agent/prompts.py`: 对比分析 prompt

---

### 任务 2: 诊断报告导出 (P1)

**描述**: 支持导出 AI 分析报告为 PDF/Markdown 格式

**用户价值**:
- 存档飞行分析记录
- 分享给团队成员
- 生成正式报告

**技术方案**:
```
1. 新增报告生成模块
2. Markdown 导出: 简单，直接生成
3. PDF 导出: 使用 weasyprint 或 reportlab
4. 报告内容:
   - 飞行基本信息
   - 健康状态摘要
   - 关键事件时间线
   - AI 分析结论
   - 建议和参数推荐
```

**工作量**: 1-2 天

**文件改动**:
- `modules/report_generator.py`: 新建
- `app.py`: 导出按钮 UI

---

### 任务 3: 用户配置持久化 (P1)

**描述**: 保存用户的 API Key、模型偏好等设置

**用户价值**:
- 无需每次重新输入 API Key
- 保存个人偏好设置
- 提升使用便捷性

**技术方案**:
```
1. 使用本地配置文件 ~/.logcortex/config.json
2. 加密存储 API Key (可选)
3. 保存内容:
   - API provider 和 key
   - 默认模型选择
   - UI 偏好设置
   - 最近打开的日志列表
```

**工作量**: 0.5 天

**文件改动**:
- `modules/config.py`: 新建
- `app.py`: 加载/保存配置

---

### 任务 4: 图表嵌入 AI 回复 (P1)

**描述**: AI 分析时自动生成相关图表并嵌入回复

**用户价值**:
- 直观展示数据趋势
- 图文结合更易理解
- 专业级分析报告

**技术方案**:
```
1. AI 分析时识别需要可视化的数据
2. 自动调用图表生成函数
3. 在 AI 回复下方展示相关图表
4. 使用 Streamlit columns 布局
```

**工作量**: 2 天

**文件改动**:
- `modules/ai_agent/tools.py`: 新增图表生成工具
- `app.py`: 图表嵌入显示逻辑

---

### 任务 5: 飞行模式智能识别 (P2)

**描述**: 自动识别和标注飞行模式切换点

**用户价值**:
- 快速定位关键飞行阶段
- 自动生成飞行时间线
- 辅助问题定位

**技术方案**:
```
1. 解析 vehicle_status 消息
2. 识别模式切换时间点
3. 标注各阶段: 起飞、悬停、航线、降落等
4. 在时间线上可视化显示
```

**工作量**: 1 天

**文件改动**:
- `modules/analyzer.py`: 新增模式识别方法
- `modules/ui_components.py`: 时间线可视化

---

### 任务 6: 参数调优建议引擎 (P2)

**描述**: 基于分析结果，智能推荐参数调整

**用户价值**:
- 获得 Tuning 建议
- 减少调参试错时间
- 提升飞行性能

**技术方案**:
```
1. 建立问题-参数映射知识库
2. 根据检测结果匹配推荐
3. 生成具体参数建议
4. 解释原因和预期效果

示例:
- 震动高 → 推荐 INS_ACCEL_FILTER
- GPS 弱 → 推荐 EKF2_GPS_CHECK
- 响应慢 → 推荐 MC_ROLL_P 等
```

**工作量**: 2-3 天

**文件改动**:
- `modules/tuning_advisor.py`: 新建
- `modules/ai_agent/tools.py`: 新增调优工具

---

### 任务 7: 历史记录管理 (P2)

**描述**: 保存和管理历史分析记录

**用户价值**:
- 回顾历史分析
- 追踪问题变化
- 建立知识库

**技术方案**:
```
1. SQLite 本地数据库
2. 存储: 日志文件路径、分析时间、结果摘要
3. 历史记录浏览 UI
4. 支持重新加载和继续分析
```

**工作量**: 1-2 天

**文件改动**:
- `modules/history.py`: 新建
- `app.py`: 历史记录 UI

---

### 任务 8: 离线模式增强 (P3)

**描述**: 支持本地运行的开源模型

**用户价值**:
- 无需联网使用
- 数据隐私保护
- 降低 API 成本

**技术方案**:
```
1. 支持 Ollama 本地部署
2. 支持 LM Studio
3. 模型要求: 支持工具调用
4. 常见模型: Qwen2.5, Llama3
```

**工作量**: 1 天

**文件改动**:
- `app.py`: 新增本地模型配置
- `provider_configs`: 扩展

---

## 推荐开发顺序

基于用户价值和实现复杂度，建议按以下顺序开发：

```
Phase 1 (核心增强):
├── 任务 3: 用户配置持久化 (0.5天)
├── 任务 1: 多日志对比分析 (2-3天)
└── 任务 4: 图表嵌入 AI 回复 (2天)

Phase 2 (体验提升):
├── 任务 2: 诊断报告导出 (1-2天)
├── 任务 5: 飞行模式智能识别 (1天)
└── 任务 6: 参数调优建议引擎 (2-3天)

Phase 3 (高级功能):
├── 任务 7: 历史记录管理 (1-2天)
└── 任务 8: 离线模式增强 (1天)
```

---

## 技术债务

| 项目 | 说明 | 建议 |
|------|------|------|
| 测试覆盖 | 缺少单元测试 | 补充 pytest 测试 |
| 错误处理 | 部分异常处理不完善 | 增加全局异常捕获 |
| 日志系统 | 使用 print 调试 | 改用 logging 模块 |
| 类型注解 | 部分函数缺少类型 | 补充 type hints |

---

*文档版本: 1.0*
*更新日期: 2026-02-14*
*维护者: Claude AI Assistant*
